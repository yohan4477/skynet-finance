<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ì¬ë¬´ì œí‘œ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
	<style>
		* { margin: 0; padding: 0; box-sizing: border-box; }

		body {
			font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			min-height: 100vh;
			padding: 20px;
		}

		.container {
			max-width: 1600px;
			margin: 0 auto;
			background: white;
			border-radius: 20px;
			padding: 40px;
			box-shadow: 0 20px 60px rgba(0,0,0,0.3);
		}

		header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			margin-bottom: 30px;
			border-bottom: 3px solid #667eea;
			padding-bottom: 20px;
			gap: 30px;
		}

		.header-center {
			flex: 1;
			text-align: center;
		}

		.search-wrapper {
			position: relative;
			min-width: 280px;
		}

		#companySearch {
			width: 100%;
			padding: 12px 40px 12px 15px;
			font-size: 14px;
			border: 2px solid #667eea;
			border-radius: 50px;
			outline: none;
			transition: all 0.3s;
		}

		#companySearch:focus {
			box-shadow: 0 0 15px rgba(102, 126, 234, 0.4);
			border-color: #764ba2;
		}

		.search-icon {
			position: absolute;
			right: 15px;
			top: 50%;
			transform: translateY(-50%);
			color: #667eea;
			font-size: 18px;
			pointer-events: none;
		}

		.search-results {
			position: absolute;
			top: 100%;
			left: 0;
			right: 0;
			background: white;
			border: 2px solid #667eea;
			border-radius: 15px;
			margin-top: 8px;
			max-height: 400px;
			overflow-y: auto;
			box-shadow: 0 10px 30px rgba(0,0,0,0.2);
			z-index: 1000;
			display: none;
		}

		.search-results.show {
			display: block;
		}

		.search-result-item {
			padding: 12px 20px;
			cursor: pointer;
			border-bottom: 1px solid #ecf0f1;
			transition: all 0.2s;
		}

		.search-result-item:last-child {
			border-bottom: none;
		}

		.search-result-item:hover {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
		}

		.company-name {
			font-weight: bold;
			font-size: 15px;
		}

		.company-info {
			font-size: 12px;
			color: #7f8c8d;
			margin-top: 3px;
		}

		.search-result-item:hover .company-info {
			color: rgba(255,255,255,0.8);
		}

		.no-results {
			padding: 20px;
			text-align: center;
			color: #7f8c8d;
		}

		h1 {
			color: #2c3e50;
			font-size: 32px;
			margin-bottom: 10px;
		}

		.controls {
			display: flex;
			justify-content: center;
			gap: 20px;
			margin-bottom: 30px;
			flex-wrap: wrap;
		}

		select, .view-btn {
			padding: 12px 25px;
			font-size: 14px;
			font-weight: bold;
			border: 2px solid #667eea;
			border-radius: 50px;
			cursor: pointer;
			background: white;
			color: #2c3e50;
			transition: all 0.3s;
		}

		.view-btn.active {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
		}

		.view-content { display: none; }
		.view-content.active { display: block; animation: fadeIn 0.5s; }

		@keyframes fadeIn {
			from { opacity: 0; transform: translateY(20px); }
			to { opacity: 1; transform: translateY(0); }
		}

		.chart-container {
			height: 500px;
			margin-bottom: 30px;
			background: #f8f9fa;
			padding: 20px;
			border-radius: 15px;
		}

		/* T-Account ìŠ¤íƒ€ì¼ */
		.t-account-container {
			display: grid;
			grid-template-columns: 1fr 2px 1fr;
			gap: 0;
			min-height: 500px;
			background: white;
			border-radius: 15px;
			padding: 30px;
			box-shadow: 0 5px 15px rgba(0,0,0,0.1);
		}

		.t-column {
			display: flex;
			flex-direction: column;
			gap: 2px;
		}

		.t-divider {
			background: #2c3e50;
			width: 3px;
		}

		.t-title {
			text-align: center;
			font-size: 20px;
			font-weight: bold;
			color: #2c3e50;
			margin-bottom: 20px;
			padding: 10px;
			background: #ecf0f1;
			border-radius: 10px;
		}

		.t-item {
			position: relative;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			border-radius: 8px;
			padding: 8px 12px;
			color: white;
			cursor: pointer;
			transition: all 0.3s;
			display: flex;
			justify-content: space-between;
			align-items: center;
			overflow: hidden;
		}

		.t-item:hover {
			transform: scale(1.02);
			box-shadow: 0 8px 20px rgba(0,0,0,0.2);
		}

		.t-item.expense { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); }
		.t-item.profit { background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); }
		.t-item.revenue { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); }

		.t-label {
			font-size: 13px;
			font-weight: bold;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
			flex: 1;
			margin-right: 10px;
		}

		.t-amount {
			font-size: 14px;
			font-weight: bold;
			white-space: nowrap;
			text-align: right;
		}

		.t-group-wrapper {
			display: grid;
			grid-template-columns: 120px 1fr;
			gap: 10px;
			margin-bottom: 8px;
			align-items: center;
		}

		.t-group-label {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			padding: 10px 15px;
			border-radius: 8px;
			font-size: 13px;
			font-weight: bold;
			color: white;
			text-align: center;
			box-shadow: 0 2px 5px rgba(0,0,0,0.1);
			height: 100%;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			gap: 3px;
			transition: all 0.3s;
		}

		.t-group-label:hover {
			transform: scale(1.02);
			box-shadow: 0 8px 20px rgba(0,0,0,0.2);
		}

		.t-group-total {
			font-size: 14px;
			color: white;
			font-weight: bold;
		}

		.t-group {
			border: 2px dashed rgba(108, 122, 137, 0.5);
			border-radius: 12px;
			padding: 8px;
			position: relative;
		}

		.t-group-content {
			display: flex;
			flex-direction: column;
			gap: 2px;
		}

		.t-caption {
			display: none;
			position: absolute;
			bottom: 100%;
			left: 50%;
			transform: translateX(-50%);
			background: rgba(0,0,0,0.9);
			color: white;
			padding: 12px 15px;
			border-radius: 8px;
			font-size: 12px;
			white-space: nowrap;
			z-index: 10;
			margin-bottom: 10px;
		}

		.t-item:hover .t-caption {
			display: block;
		}

		/* ì¬ë¬´ìƒíƒœí‘œ ìŠ¤íƒ€ì¼ */
		.bs-container {
			display: grid;
			grid-template-columns: 1fr 3px 1fr;
			gap: 0;
			min-height: 600px;
			background: white;
			border-radius: 15px;
			padding: 30px;
		}

		.bs-column {
			display: flex;
			flex-direction: column;
			gap: 10px;
		}

		.bs-item {
			background: #ecf0f1;
			border-radius: 10px;
			padding: 15px;
			cursor: pointer;
			transition: all 0.3s;
			position: relative;
		}

		.bs-item:hover {
			transform: translateX(5px);
			box-shadow: 0 5px 15px rgba(0,0,0,0.1);
		}

		.bs-item.asset { border-left: 5px solid #3498db; }
		.bs-item.liability { border-left: 5px solid #e74c3c; }
		.bs-item.equity { border-left: 5px solid #2ecc71; }

		.comparison-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 30px;
		}

		.company-section {
			background: #f8f9fa;
			padding: 20px;
			border-radius: 15px;
		}

		.company-header {
			text-align: center;
			font-size: 20px;
			font-weight: bold;
			margin-bottom: 20px;
			padding: 15px;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			border-radius: 10px;
		}

		/* ë°˜ì‘í˜• ë””ìì¸ */
		@media (max-width: 768px) {
			.container {
				padding: 20px;
			}

			header {
				flex-direction: column;
				gap: 15px;
				padding-bottom: 15px;
			}

			.header-center {
				order: -1; /* ì œëª©ì„ ë§¨ ìœ„ë¡œ */
			}

			.search-wrapper {
				width: 100%;
				min-width: unset;
			}

			header > div:last-child {
				width: 100%;
				justify-content: center;
			}

			h1 {
				font-size: 24px;
			}

			.controls {
				flex-direction: column;
				gap: 10px;
			}

			select, .view-btn {
				width: 100%;
				font-size: 13px;
				padding: 10px 15px;
			}

			.chart-container {
				height: 300px; /* ëª¨ë°”ì¼ì—ì„œ ì°¨íŠ¸ ë†’ì´ ì¤„ì„ */
				padding: 15px;
			}

			.t-account-container, .bs-container {
				grid-template-columns: 1fr; /* ëª¨ë°”ì¼ì—ì„œ ë‹¨ì¼ ì»¬ëŸ¼ */
				padding: 15px;
				min-height: unset;
			}

			.t-divider {
				display: none; /* ëª¨ë°”ì¼ì—ì„œ êµ¬ë¶„ì„  ìˆ¨ê¹€ */
			}

			.t-title {
				font-size: 18px;
				margin-bottom: 15px;
			}

			.t-group-wrapper {
				grid-template-columns: 1fr; /* ê·¸ë£¹ ë¼ë²¨ê³¼ ë‚´ìš©ë„ ë‹¨ì¼ ì»¬ëŸ¼ */
			}

			.t-group-label {
				height: auto;
				padding: 8px 10px;
				font-size: 12px;
				flex-direction: row;
				justify-content: space-between;
			}

			.t-item {
				padding: 6px 10px;
			}

			.t-label {
				font-size: 12px;
			}

			.t-amount {
				font-size: 13px;
			}

			.t-caption {
				font-size: 10px;
				padding: 8px 10px;
			}
		}

		@media (max-width: 480px) {
			body {
				padding: 10px;
			}

			.container {
				padding: 15px;
			}

			h1 {
				font-size: 20px;
			}

			.chart-container {
				height: 250px;
			}
		}
	</style>
</head>
<body>
	<div class="container">
		<header>
			<div class="search-wrapper">
				<input type="text" id="companySearch" placeholder="ğŸ” ì¢…ëª© ê²€ìƒ‰ (ì˜ˆ: ì‚¼ì„±ì „ì, SKí•˜ì´ë‹‰ìŠ¤...)" autocomplete="off">
				<span class="search-icon">ğŸ”</span>
				<div id="searchResults" class="search-results"></div>
			</div>
			<div class="header-center">
				<h1>ğŸ“Š ì¬ë¬´ì œí‘œ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h1>
				<p style="color: #7f8c8d;">Financial Statement Analysis Dashboard</p>
			</div>
			<div style="min-width: 280px; display: flex; justify-content: flex-end;">
				<button onclick="goToIndex()" style="padding: 12px 25px; font-size: 14px; font-weight: bold; border: 2px solid #667eea; border-radius: 50px; cursor: pointer; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; transition: all 0.3s;">
					ğŸ“‹ ì¢…ëª© ë¦¬ìŠ¤íŠ¸
				</button>
			</div>
		</header>

		<div class="controls">
			<button class="view-btn active" onclick="switchView('trend')">ğŸ“ˆ ë§¤ì¶œ/ì˜ì—…ì´ìµ ì¶”ì´</button>
			<button class="view-btn" onclick="switchView('income')">ğŸ“‹ ì†ìµê³„ì‚°ì„œ</button>
			<button class="view-btn" onclick="switchView('balance')">âš–ï¸ ì¬ë¬´ìƒíƒœí‘œ</button>
			<button class="view-btn" onclick="switchView('cashflow')">ğŸ’§ í˜„ê¸ˆíë¦„</button>
		</div>

		<!-- ì¶”ì´ ì°¨íŠ¸ -->
		<div id="trendView" class="view-content active">
			<div style="display: flex; gap: 20px; align-items: start; margin-bottom: 20px;">
				<div style="min-width: 200px;">
					<label style="display: block; margin-bottom: 8px; font-weight: bold; color: #2c3e50;">ì¢…ëª© ì„ íƒ</label>
					<select id="companySelect" onchange="changeCompany()" style="width: 100%; padding: 10px 15px; font-size: 14px; border: 2px solid #667eea; border-radius: 10px; background: white; cursor: pointer;">
						<option value="">-- ì¢…ëª©ì„ ì„ íƒí•˜ì„¸ìš” --</option>
					</select>
				</div>
				<div style="flex: 1;">
					<div class="chart-container">
						<canvas id="trendChart"></canvas>
					</div>
				</div>
			</div>
		</div>

		<!-- ì†ìµê³„ì‚°ì„œ T-Account -->
		<div id="incomeView" class="view-content">
			<div id="incomeStatement"></div>
		</div>

		<!-- ì¬ë¬´ìƒíƒœí‘œ -->
		<div id="balanceView" class="view-content">
			<div id="balanceSheet"></div>
		</div>

		<!-- í˜„ê¸ˆíë¦„ -->
		<div id="cashflowView" class="view-content">
			<div class="chart-container">
				<canvas id="cashflowChart"></canvas>
			</div>
		</div>

		

		<div style="text-align: center; margin-top: 30px; color: #7f8c8d; font-size: 14px;">
			<p>ğŸ“¡ ë°ì´í„° ì¶œì²˜: ê¸ˆìœµê°ë…ì› ì „ìê³µì‹œì‹œìŠ¤í…œ (DART)</p>
		</div>
	</div>

	<script>
		let charts = {};
		let samsungData = [];
		let hynixData = [];
		let samsungQuarterlyData = [];
		let samsungCashflowData = { annual: [], quarterly: [] };

		// 10ëŒ€ ê¸°ì—… ë°ì´í„°
		const companies = [
			{ name: "ì‚¼ì„±ì „ì", code: "00126380", stock: "005930", sector: "ì „ì", file: "00126380_10year_data.json" },
			{ name: "SKí•˜ì´ë‹‰ìŠ¤", code: "00164779", stock: "000660", sector: "ì „ì", file: "00164779_10year_data.json" },
			{ name: "LGì—ë„ˆì§€ì†”ë£¨ì…˜", code: "00164742", stock: "373220", sector: "ì „ì", file: "00164742_10year_data.json" },
			{ name: "ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤", code: "00113399", stock: "207940", sector: "ì œì•½", file: "00113399_10year_data.json" },
			{ name: "í˜„ëŒ€ì°¨", code: "00165890", stock: "005380", sector: "ìë™ì°¨", file: "00165890_10year_data.json" },
			{ name: "ì…€íŠ¸ë¦¬ì˜¨", code: "00164529", stock: "068270", sector: "ì œì•½", file: "00164529_10year_data.json" },
			{ name: "ê¸°ì•„", code: "00167799", stock: "000270", sector: "ìë™ì°¨", file: "00167799_10year_data.json" },
			{ name: "POSCOí™€ë”©ìŠ¤", code: "00159645", stock: "005490", sector: "ì² ê°•", file: "00159645_10year_data.json" },
			{ name: "KBê¸ˆìœµ", code: "00356370", stock: "105560", sector: "ê¸ˆìœµ", file: "00356370_10year_data.json" },
			{ name: "ì‹ í•œì§€ì£¼", code: "00168099", stock: "055550", sector: "ê¸ˆìœµ", file: "00168099_10year_data.json" }
		];

		let allCompanyData = {};
		let allCashflowData = {};
		let allBalanceSheetData = {};
		let currentCompanyCode = null;
		let currentCompanyName = null;

		Chart.register(ChartDataLabels);

		// ê²€ìƒ‰ ê¸°ëŠ¥
		const searchInput = document.getElementById('companySearch');
		const searchResults = document.getElementById('searchResults');

		searchInput.addEventListener('input', (e) => {
			const query = e.target.value.trim().toLowerCase();

			if (query.length === 0) {
				searchResults.classList.remove('show');
				return;
			}

			const filtered = companies.filter(company =>
				company.name.toLowerCase().includes(query) ||
				company.stock.includes(query) ||
				company.sector.toLowerCase().includes(query)
			);

			if (filtered.length === 0) {
				searchResults.innerHTML = '<div class="no-results">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
				searchResults.classList.add('show');
				return;
			}

			searchResults.innerHTML = filtered.map(company => `
				<div class="search-result-item" onclick="selectCompany('${company.code}', '${company.name}', '${company.file}')">
					<div class="company-name">${company.name}</div>
					<div class="company-info">${company.stock} | ${company.sector}</div>
				</div>
			`).join('');

			searchResults.classList.add('show');
		});

		// ê²€ìƒ‰ì°½ ì™¸ë¶€ í´ë¦­ ì‹œ ê²°ê³¼ ë‹«ê¸°
		document.addEventListener('click', (e) => {
			if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
				searchResults.classList.remove('show');
			}
		});

		// ì¢…ëª© ì„ íƒ
		async function selectCompany(code, name, file) {
			searchResults.classList.remove('show');
			searchInput.value = name;

			// í˜„ì¬ ì„ íƒëœ íšŒì‚¬ ì €ì¥
			currentCompanyCode = code;
			currentCompanyName = name;

			// ë“œë¡­ë‹¤ìš´ë„ í•´ë‹¹ ì¢…ëª©ìœ¼ë¡œ ì„¤ì •
			const select = document.getElementById('companySelect');
			const optionValue = JSON.stringify({ code: code, name: name, file: file });
			select.value = optionValue;

			// í•´ë‹¹ ê¸°ì—… ë°ì´í„° ë¡œë“œ
			try {
				const response = await fetch(`/api/company_data?corp_code=${code}`);
				if (response.ok) {
					const data = await response.json();
					allCompanyData[code] = data.filter(d => d.revenue > 0);

					                    // í˜„ê¸ˆíë¦„ ë°ì´í„°ë„ í•¨ê»˜ ë¡œë“œ
					                    const cashflowFile = `/api/cashflow_data?corp_code=${code}`;
					                    try {
					                        const cashflowResponse = await fetch(cashflowFile);
					                        if (cashflowResponse.ok) {
					                            allCashflowData[code] = await cashflowResponse.json();
					                        } else {
					                            allCashflowData[code] = null;
					                        }
					                    } catch (e) {
					                        console.warn(`${name} í˜„ê¸ˆíë¦„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:`, e);
					                        allCashflowData[code] = null;
					                    }
					// ì¬ë¬´ìƒíƒœí‘œ ë°ì´í„° ë¡œë“œ
					const balanceSheetFile = `/api/balance_sheet?corp_code=${code}`;
					try {
						const balanceSheetResponse = await fetch(balanceSheetFile);
						if (balanceSheetResponse.ok) {
							allBalanceSheetData[code] = await balanceSheetResponse.json();
						} else {
							allBalanceSheetData[code] = null; // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°
						}
					} catch (e) {
						console.warn(`${name} ì¬ë¬´ìƒíƒœí‘œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:`, e);
						allBalanceSheetData[code] = null;
					}


					// ì°¨íŠ¸ ì—…ë°ì´íŠ¸
					updateChartsForCompany(code, name);
				} else {
					alert(`${name} ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
				}
			} catch (error) {
				console.error(`${name} ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:`, error);
				alert(`${name} ë°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.`);
			}
		}

		function updateChartsForCompany(code, name) {
			const data = allCompanyData[code];
			if (!data || data.length === 0) return;

			// ì¶”ì´ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
			const ctx = document.getElementById('trendChart').getContext('2d');
			if (charts.trend) charts.trend.destroy();

			const labels = data.map(d => d.year + 'ë…„');
			const revenues = data.map(d => d.revenue / 1000000000000);
			const profits = data.map(d => d.operating_profit / 1000000000000);
			const margins = data.map(d => (d.operating_profit / d.revenue * 100));

			charts.trend = new Chart(ctx, {
				type: 'bar',
				data: {
					labels: labels,
					datasets: [{
						label: 'ë§¤ì¶œ (ì¡°ì›)',
						data: revenues,
						backgroundColor: 'rgba(102, 126, 234, 0.7)',
						borderColor: 'rgba(102, 126, 234, 1)',
						borderWidth: 2,
						borderRadius: 8,
						yAxisID: 'y'
					}, {
						label: 'ì˜ì—…ì´ìµ (ì¡°ì›)',
						data: profits,
						type: 'line',
						borderColor: 'rgba(255, 99, 132, 1)',
						backgroundColor: 'rgba(255, 99, 132, 0.2)',
						borderWidth: 3,
						pointRadius: 6,
						tension: 0.4,
						yAxisID: 'y'
					}, {
						label: 'ì˜ì—…ì´ìµë¥  (%)',
						data: margins,
						type: 'line',
						borderColor: 'rgba(46, 204, 113, 1)',
						backgroundColor: 'rgba(46, 204, 113, 0.1)',
						borderWidth: 3,
						borderDash: [5, 5],
						pointRadius: 8,
						pointStyle: 'circle',
						tension: 0.4,
						yAxisID: 'y1'
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					interaction: {
						mode: 'index',
						intersect: false
					},
					plugins: {
						title: { display: true, text: `${name} ë§¤ì¶œ ë° ì˜ì—…ì´ìµ ì¶”ì´`, font: { size: 18 } },
						legend: { display: true, position: 'top' },
						tooltip: {
							callbacks: {
								label: function(context) {
									let label = context.dataset.label || '';
									if (label) label += ': ';
									if (context.datasetIndex === 2) {
										label += context.parsed.y.toFixed(2) + '%';
									} else {
										label += context.parsed.y.toFixed(1) + 'ì¡°ì›';
									}
									return label;
								}
							}
						},
						datalabels: {
							anchor: 'end',
							align: 'top',
							formatter: function(value, context) {
								if (context.datasetIndex === 2) {
									return value.toFixed(1) + '%';
								} else {
									return value.toFixed(1) + 'ì¡°';
								}
							},
							font: {
								weight: 'bold'
							}
						}
					},
					scales: {
						y: {
							type: 'linear',
							display: true,
							position: 'left',
							beginAtZero: true,
							title: { display: true, text: 'ê¸ˆì•¡ (ì¡°ì›)' },
							ticks: { callback: v => v.toFixed(0) + 'ì¡°' }
						},
						y1: {
							type: 'linear',
							display: true,
							position: 'right',
							beginAtZero: true,
							max: Math.max(...margins) * 1.2,
							title: { display: true, text: 'ì˜ì—…ì´ìµë¥  (%)' },
							ticks: { callback: v => v.toFixed(0) + '%' },
							grid: { drawOnChartArea: false }
						}
					}
				}
			});

			// ì†ìµê³„ì‚°ì„œ ì—…ë°ì´íŠ¸
			const latestData = data[data.length - 1];
			renderSingleIncome(document.getElementById('incomeStatement'), latestData, name);

			// ì¬ë¬´ìƒíƒœí‘œ ì—…ë°ì´íŠ¸
			updateBalanceSheet();

			// í˜„ê¸ˆíë¦„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
			updateCashflowChart();
		}

		// URL íŒŒë¼ë¯¸í„° í™•ì¸
		function getURLParams() {
			const params = new URLSearchParams(window.location.search);
			return {
				company: params.get('company'),
				name: params.get('name'),
				file: params.get('file')
			};
		}

		// ì¢…ëª© ì„ íƒ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
		function populateCompanySelect() {
			const select = document.getElementById('companySelect');
			companies.forEach(company => {
				const option = document.createElement('option');
				option.value = JSON.stringify({ code: company.code, name: company.name, file: company.file });
				option.textContent = `${company.name} (${company.stock})`;
				select.appendChild(option);
			});
		}

		// ë“œë¡­ë‹¤ìš´ì—ì„œ ì¢…ëª© ë³€ê²½
		function changeCompany() {
			const select = document.getElementById('companySelect');
			const selectedValue = select.value;

			if (!selectedValue) return;

			const companyData = JSON.parse(selectedValue);
			selectCompany(companyData.code, companyData.name, companyData.file);
		}

		// ë°ì´í„° ë¡œë“œ
		async function loadData() {
			try {
				// ì¢…ëª© ì„ íƒ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
				populateCompanySelect();

				// URLì—ì„œ íŒŒë¼ë¯¸í„° í™•ì¸
				const urlParams = getURLParams();

				if (urlParams.company && urlParams.name && urlParams.file) {
					// íŠ¹ì • ê¸°ì—…ìœ¼ë¡œ ì§ì ‘ ì ‘ê·¼í•œ ê²½ìš°
					searchInput.value = urlParams.name;
					await selectCompany(urlParams.company, urlParams.name, urlParams.file);

					// ë“œë¡­ë‹¤ìš´ë„ í•´ë‹¹ ì¢…ëª©ìœ¼ë¡œ ì„¤ì •
					const select = document.getElementById('companySelect');
					const optionValue = JSON.stringify({ code: urlParams.company, name: urlParams.name, file: urlParams.file });
					select.value = optionValue;
				} else {
					                    					// ê¸°ë³¸ ì‚¼ì„±ì „ì ë°ì´í„° ë¡œë“œ
					                    					const [response1, response2, response3, response4, response5] = await Promise.all([
					                    						fetch('/api/company_data?corp_code=00126380'),
					                    						fetch('/api/company_data?corp_code=00164779').catch(e => console.warn('SKí•˜ì´ë‹‰ìŠ¤ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e)),
					                    						fetch('/api/quarterly_data?corp_code=00126380').catch(e => console.warn('ì‚¼ì„± ë¶„ê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e)),
					                    						fetch('/api/cashflow_data?corp_code=00126380').catch(e => console.warn('ì‚¼ì„± í˜„ê¸ˆíë¦„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e)),
					                    						fetch('/api/balance_sheet?corp_code=00126380').catch(e => console.warn('ì‚¼ì„± ì¬ë¬´ìƒíƒœí‘œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e))
					                    					]);
					                    
					                    					samsungData = (await response1.json()).filter(d => d.revenue > 0);
					                    					if (response2 && response2.ok) {
					                    						hynixData = (await response2.json()).filter(d => d.revenue > 0);
					                    					}
					                    					                    // if (response3 && response3.ok) {
					                    					                    //  samsungQuarterlyData = (await response3.json()).filter(d => d.revenue > 0);
					                    					                    // }
					                    					                    if (response4 && response4.ok) {
					                    					                        samsungCashflowData = await response4.json();
					                    					                    }
					                    					                    if (response5 && response5.ok) {
					                    					                        allBalanceSheetData["00126380"] = await response5.json();
					                    					                    }
					                    					
					                    					                    // ë¶„ê¸° ë°ì´í„°ëŠ” ë³„ë„ë¡œ ë¡œë“œ (í˜„ì¬ëŠ” ì‚¼ì„±ì „ìë§Œ)
					                    					                    const quarterlyResponse = await fetch('/api/quarterly_data?corp_code=00126380').catch(e => console.warn('ì‚¼ì„± ë¶„ê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e));
					                    					                    if (quarterlyResponse && quarterlyResponse.ok) {
					                    					                        samsungQuarterlyData = (await quarterlyResponse.json()).filter(d => d.revenue > 0);
					                    					                    }
					                    					
					                    					                    updateAll();
				}
			} catch (error) {
				console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
			}
		}

		function switchView(view) {
			document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
			event.target.classList.add('active');
			document.querySelectorAll('.view-content').forEach(el => el.classList.remove('active'));
			document.getElementById(view + 'View').classList.add('active');
		}

		function updateAll() {
			// ì´ˆê¸° ë¡œë“œ ì‹œ ì‚¼ì„±ì „ì ë°ì´í„°ë¡œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
			updateChartsForCompany("00126380", "ì‚¼ì„±ì „ì");
		}

		// 2. ì†ìµê³„ì‚°ì„œ T-Account (ë¹„ë¡€ í¬ê¸°)
		function updateIncomeStatement() {
			// ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ í‘œì‹œ
			if (samsungData.length > 0) {
				const container = document.getElementById('incomeStatement');
				renderSingleIncome(container, samsungData[samsungData.length - 1], 'ì‚¼ì„±ì „ì');
			}
		}

		function renderSingleIncome(container, data, companyName) {
			const total = data.revenue;
			const sellingAdminExpenses = data.selling_admin_expenses || 0;

			// ë§¤ì¶œì›ê°€ ì„¸ë¶€ êµ¬ì„± (ì¶”ì • ë¹„ìœ¨)
			const materialCost = data.cost_of_sales * 0.60; // ì¬ë£Œë¹„ 60%
			const laborCost = data.cost_of_sales * 0.25; // ë…¸ë¬´ë¹„ 25%
			const overheadCost = data.cost_of_sales * 0.15; // ì œì¡°ê²½ë¹„ 15%

			// íŒê´€ë¹„ ì„¸ë¶€ êµ¬ì„± (ì¶”ì • ë¹„ìœ¨)
			const rdExpense = sellingAdminExpenses * 0.40; // ì—°êµ¬ê°œë°œë¹„ 40%
			const marketingExpense = sellingAdminExpenses * 0.25; // ê´‘ê³ ì„ ì „ë¹„ 25%
			const personnelExpense = sellingAdminExpenses * 0.35; // ê¸‰ì—¬/ë³µë¦¬í›„ìƒ 35%

			const materialHeight = (materialCost / total) * 500;
			const laborHeight = (laborCost / total) * 500;
			const overheadHeight = (overheadCost / total) * 500;

			const rdHeight = (rdExpense / total) * 500;
			const marketingHeight = (marketingExpense / total) * 500;
			const personnelHeight = (personnelExpense / total) * 500;

			const profitHeight = (data.operating_profit / total) * 500;
			const revenueHeight = 500;

			container.innerHTML = `
				<div class="t-account-container">
					<div class="t-column">
						<div class="t-title">ë¹„ìš© + ì˜ì—…ì´ìµ</div>

						<!-- ë§¤ì¶œì›ê°€ ê·¸ë£¹ -->
						<div class="t-group-wrapper">
							<div class="t-group-label">
								<div>ğŸ’° ë§¤ì¶œì›ê°€</div>
								<div class="t-group-total">${(data.cost_of_sales / 1000000000000).toFixed(1)}ì¡°ì›</div>
							</div>
							<div class="t-group">
								<div class="t-group-content">
									<div class="t-item expense" style="height: ${materialHeight}px; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
										<div class="t-label">ì¬ë£Œë¹„</div>
										<div class="t-amount">${(materialCost / 1000000000000).toFixed(1)}ì¡°</div>
										<div class="t-caption">ì›ì¬ë£Œ, ë¶€ì¬ë£Œ, ì†Œëª¨í’ˆ ë“± ì§ì ‘ íˆ¬ì… ì¬ë£Œë¹„ìš©</div>
									</div>
									<div class="t-item expense" style="height: ${laborHeight}px; background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);">
										<div class="t-label">ë…¸ë¬´ë¹„</div>
										<div class="t-amount">${(laborCost / 1000000000000).toFixed(1)}ì¡°</div>
										<div class="t-caption">ìƒì‚°ì§ ê·¼ë¡œì ê¸‰ì—¬, ìƒì—¬ê¸ˆ, í‡´ì§ê¸‰ì—¬ ë“±</div>
									</div>
									<div class="t-item expense" style="height: ${overheadHeight}px; background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
										<div class="t-label">ì œì¡°ê²½ë¹„</div>
										<div class="t-amount">${(overheadCost / 1000000000000).toFixed(1)}ì¡°</div>
										<div class="t-caption">ê°ê°€ìƒê°ë¹„, ìˆ˜ì„ ë¹„, ì „ë ¥ë¹„, ê¸°íƒ€ ì œì¡° ê´€ë ¨ ê²½ë¹„</div>
									</div>
								</div>
							</div>
						</div>

						<!-- íŒë§¤ê´€ë¦¬ë¹„ ê·¸ë£¹ -->
						<div class="t-group-wrapper">
							<div class="t-group-label">
								<div>ğŸ“Š íŒë§¤ê´€ë¦¬ë¹„</div>
								<div class="t-group-total">${(sellingAdminExpenses / 1000000000000).toFixed(1)}ì¡°ì›</div>
							</div>
							<div class="t-group">
								<div class="t-group-content">
									<div class="t-item expense" style="height: ${rdHeight}px; background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
										<div class="t-label">ì—°êµ¬ê°œë°œë¹„</div>
										<div class="t-amount">${(rdExpense / 1000000000000).toFixed(1)}ì¡°</div>
										<div class="t-caption">ì‹ ì œí’ˆ ì—°êµ¬, ê¸°ìˆ  ê°œë°œ, ì—°êµ¬ì†Œ ìš´ì˜ë¹„ ë“±</div>
									</div>
									<div class="t-item expense" style="height: ${marketingHeight}px; background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);">
										<div class="t-label">ê´‘ê³ ì„ ì „ë¹„</div>
										<div class="t-amount">${(marketingExpense / 1000000000000).toFixed(1)}ì¡°</div>
										<div class="t-caption">ê´‘ê³ , ë§ˆì¼€íŒ…, íŒì´‰, ë¸Œëœë”© í™œë™ ë¹„ìš©</div>
									</div>
									<div class="t-item expense" style="height: ${personnelHeight}px; background: linear-gradient(135deg, #7f8c8d 0%, #6c7a89 100%);">
										<div class="t-label">ì¸ê±´ë¹„</div>
										<div class="t-amount">${(personnelExpense / 1000000000000).toFixed(1)}ì¡°</div>
										<div class="t-caption">ì‚¬ë¬´ì§/ì˜ì—…ì§ ê¸‰ì—¬, ë³µë¦¬í›„ìƒë¹„, êµìœ¡í›ˆë ¨ë¹„ ë“±</div>
									</div>
								</div>
							</div>
						</div>

						<!-- ì˜ì—…ì´ìµ -->
						<div class="t-item profit" style="height: ${profitHeight}px;">
							<div class="t-label">ğŸ’š ì˜ì—…ì´ìµ</div>
							<div class="t-amount">${(data.operating_profit / 1000000000000).toFixed(1)}ì¡°</div>
							<div class="t-caption">ë§¤ì¶œì´ì´ìµì—ì„œ íŒë§¤ê´€ë¦¬ë¹„ë¥¼ ëº€ ë³¸ì—…ì˜ ìˆ˜ìµì„± ì§€í‘œ</div>
						</div>
					</div>
					<div class="t-divider"></div>
					<div class="t-column">
						<div class="t-title">ë§¤ì¶œ</div>
						<div class="t-item revenue" style="height: ${revenueHeight}px;">
							<div class="t-label">ğŸ’™ ì˜ì—…ìˆ˜ìµ</div>
							<div class="t-amount">${(data.revenue / 1000000000000).toFixed(1)}ì¡°</div>
							<div class="t-caption">ì œí’ˆ ë° ì„œë¹„ìŠ¤ íŒë§¤ë¡œ ì–»ì€ ì´ ìˆ˜ìµ (${data.year}ë…„)</div>
						</div>
					</div>
				</div>
			`;
		}

		        // 3. ì¬ë¬´ìƒíƒœí‘œ (ë¹„ë¡€ í¬ê¸°) - ì„¸ë¶€ êµ¬ì„±ìš”ì†Œë¡œ ì„¸ë¶„í™”
				function updateBalanceSheet() {
					const container = document.getElementById('balanceSheet');
					container.innerHTML = ''; // Clear previous content
		
					let balanceSheetData = null;
					let companyName = 'ì„ íƒëœ íšŒì‚¬';
		
					if (currentCompanyCode && allBalanceSheetData[currentCompanyCode]) {
						balanceSheetData = allBalanceSheetData[currentCompanyCode];
						companyName = currentCompanyName;
					} else if (allBalanceSheetData["00126380"]) { // Fallback to Samsung if no company selected or data missing
						balanceSheetData = allBalanceSheetData["00126380"];
						companyName = "ì‚¼ì„±ì „ì";
					}
		
					if (!balanceSheetData || balanceSheetData.assets.total === 0) {
						container.innerHTML = `<p style="text-align: center; padding: 50px; color: #7f8c8d;">${companyName} ì¬ë¬´ìƒíƒœí‘œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
						return;
					}
		
					const total = balanceSheetData.assets.total;
		
					const currentAssets = balanceSheetData.assets.current["ìœ ë™ìì‚°"] ? balanceSheetData.assets.current["ìœ ë™ìì‚°"].amount : 0;
					const nonCurrentAssets = balanceSheetData.assets.non_current["ë¹„ìœ ë™ìì‚°"] ? balanceSheetData.assets.non_current["ë¹„ìœ ë™ìì‚°"].amount : 0;
					const currentLiab = balanceSheetData.liabilities.current["ìœ ë™ë¶€ì±„"] ? balanceSheetData.liabilities.current["ìœ ë™ë¶€ì±„"].amount : 0;
					const nonCurrentLiab = balanceSheetData.liabilities.non_current["ë¹„ìœ ë™ë¶€ì±„"] ? balanceSheetData.liabilities.non_current["ë¹„ìœ ë™ë¶€ì±„"].amount : 0;
					const equity = balanceSheetData.equity.total;
		
					// ìœ ë™ìì‚° ì„¸ë¶€ (ì‹¤ì œ ë°ì´í„° ìš°ì„ , ì—†ìœ¼ë©´ ì¶”ì • ë¹„ìœ¨)
					const cash = balanceSheetData.assets.current["í˜„ê¸ˆë°í˜„ê¸ˆì„±ìì‚°"] ? balanceSheetData.assets.current["í˜„ê¸ˆë°í˜„ê¸ˆì„±ìì‚°"].amount : currentAssets * 0.30;
					const receivables = balanceSheetData.assets.current["ë§¤ì¶œì±„ê¶Œ"] ? balanceSheetData.assets.current["ë§¤ì¶œì±„ê¶Œ"].amount : currentAssets * 0.35;
					const inventory = balanceSheetData.assets.current["ì¬ê³ ìì‚°"] ? balanceSheetData.assets.current["ì¬ê³ ìì‚°"].amount : currentAssets * 0.25;
					const otherCA = currentAssets - cash - receivables - inventory;
		
					// ë¹„ìœ ë™ìì‚° ì„¸ë¶€ (ì‹¤ì œ ë°ì´í„° ìš°ì„ , ì—†ìœ¼ë©´ ì¶”ì • ë¹„ìœ¨)
					const ppe = balanceSheetData.assets.non_current["ìœ í˜•ìì‚°"] ? balanceSheetData.assets.non_current["ìœ í˜•ìì‚°"].amount : nonCurrentAssets * 0.50;
					const intangible = balanceSheetData.assets.non_current["ë¬´í˜•ìì‚°"] ? balanceSheetData.assets.non_current["ë¬´í˜•ìì‚°"].amount : nonCurrentAssets * 0.20;
					const investments = nonCurrentAssets - ppe - intangible;
		
					// ë¶€ì±„ ë° ìë³¸ ì„¸ë¶€ (ì‹¤ì œ ë°ì´í„° ìš°ì„ , ì—†ìœ¼ë©´ ì¶”ì • ë¹„ìœ¨)
					const payables = balanceSheetData.liabilities.current["ë§¤ì…ì±„ë¬´"] ? balanceSheetData.liabilities.current["ë§¤ì…ì±„ë¬´"].amount : currentLiab * 0.40;
					const shortDebt = balanceSheetData.liabilities.current["ë‹¨ê¸°ì°¨ì…ê¸ˆ"] ? balanceSheetData.liabilities.current["ë‹¨ê¸°ì°¨ì…ê¸ˆ"].amount : currentLiab * 0.30;
					const otherCL = currentLiab - payables - shortDebt;
		
					const longDebt = balanceSheetData.liabilities.non_current["ì¥ê¸°ì°¨ì…ê¸ˆ"] ? balanceSheetData.liabilities.non_current["ì¥ê¸°ì°¨ì…ê¸ˆ"].amount : nonCurrentLiab * 0.60;
					const otherNCL = nonCurrentLiab - longDebt;
		
					const paidInCapital = balanceSheetData.equity.items["ìë³¸ê¸ˆ"] ? balanceSheetData.equity.items["ìë³¸ê¸ˆ"].amount : equity * 0.10;
					const retainedEarnings = balanceSheetData.equity.items["ì´ìµì‰ì—¬ê¸ˆ"] ? balanceSheetData.equity.items["ì´ìµì‰ì—¬ê¸ˆ"].amount : equity * 0.85;
					const otherEquity = equity - paidInCapital - retainedEarnings;
		
					const cashHeight = (cash / total) * 500;
					const receivablesHeight = (receivables / total) * 500;
					const inventoryHeight = (inventory / total) * 500;
					const otherCAHeight = (otherCA / total) * 500;
		
					const ppeHeight = (ppe / total) * 500;
					const intangibleHeight = (intangible / total) * 500;
					const investmentsHeight = (investments / total) * 500;
		
					const payablesHeight = (payables / total) * 500;
					const shortDebtHeight = (shortDebt / total) * 500;
					const otherCLHeight = (otherCL / total) * 500;
		
					const longDebtHeight = (longDebt / total) * 500;
					const otherNCLHeight = (otherNCL / total) * 500;
		
					const paidInHeight = (paidInCapital / total) * 500;
					const retainedHeight = (retainedEarnings / total) * 500;
					const otherEqHeight = (otherEquity / total) * 500;
		
					container.innerHTML = `
						<div class="t-account-container">
							<div class="t-column">
								<div class="t-title">ìì‚° (Assets)</div>
		
								<!-- ìœ ë™ìì‚° ê·¸ë£¹ -->
								<div class="t-group-wrapper">
									<div class="t-group-label">
										<div>ğŸ’µ ìœ ë™ìì‚°</div>
										<div class="t-group-total">${(currentAssets / 1000000000000).toFixed(1)}ì¡°ì›</div>
									</div>
									<div class="t-group">
										<div class="t-group-content">
											<div class="t-item" style="height: ${cashHeight}px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
												<div class="t-label">í˜„ê¸ˆë°í˜„ê¸ˆì„±ìì‚°</div>
												<div class="t-amount">${(cash / 1000000000000).toFixed(1)}ì¡°</div>
												<div class="t-caption">ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ í˜„ê¸ˆ, ë‹¹ì¢Œì˜ˆê¸ˆ, ë³´í†µì˜ˆê¸ˆ ë“±</div>
											</div>
											<div class="t-item" style="height: ${receivablesHeight}px; background: linear-gradient(135deg, #5dade2 0%, #3498db 100%);">
												<div class="t-label">ë§¤ì¶œì±„ê¶Œ</div>
												<div class="t-amount">${(receivables / 1000000000000).toFixed(1)}ì¡°</div>
												<div class="t-caption">ì œí’ˆ íŒë§¤ ëŒ€ê¸ˆ ë¯¸ìˆ˜ê¸ˆ</div>
											</div>
											<div class="t-item" style="height: ${inventoryHeight}px; background: linear-gradient(135deg, #85c1e9 0%, #5dade2 100%);">
												<div class="t-label">ì¬ê³ ìì‚°</div>
												<div class="t-amount">${(inventory / 1000000000000).toFixed(1)}ì¡°</div>
												<div class="t-caption">ì œí’ˆ, ë°˜ì œí’ˆ, ì›ì¬ë£Œ</div>
											</div>
											<div class="t-item" style="height: ${otherCAHeight}px; background: linear-gradient(135deg, #aed6f1 0%, #85c1e9 100%);">
												<div class="t-label">ê¸°íƒ€ìœ ë™ìì‚°</div>
												<div class="t-amount">${(otherCA / 1000000000000).toFixed(1)}ì¡°</div>
												<div class="t-caption">ì„ ê¸‰ë¹„ìš©, ë¯¸ìˆ˜ìˆ˜ìµ ë“±</div>
											</div>
										</div>
									</div>
								</div>
		
								<!-- ë¹„ìœ ë™ìì‚° ê·¸ë£¹ -->
								<div class="t-group-wrapper">
									<div class="t-group-label">
										<div>ğŸ¢ ë¹„ìœ ë™ìì‚°</div>
										<div class="t-group-total">${(nonCurrentAssets / 1000000000000).toFixed(1)}ì¡°ì›</div>
									</div>
									<div class="t-group">
										<div class="t-group-content">
											<div class="t-item" style="height: ${ppeHeight}px; background: linear-gradient(135deg, #2980b9 0%, #1f6391 100%);">
												<div class="t-label">ìœ í˜•ìì‚°</div>
												<div class="t-amount">${(ppe / 1000000000000).toFixed(1)}ì¡°</div>
												<div class="t-caption">í† ì§€, ê±´ë¬¼, ê¸°ê³„ì¥ì¹˜, ì°¨ëŸ‰</div>
											</div>
											<div class="t-item" style="height: ${intangibleHeight}px; background: linear-gradient(135deg, #21618c 0%, #1a5276 100%);">
												<div class="t-label">ë¬´í˜•ìì‚°</div>
												<div class="t-amount">${(intangible / 1000000000000).toFixed(1)}ì¡°</div>
												<div class="t-caption">íŠ¹í—ˆê¶Œ, ìƒí‘œê¶Œ, ì˜ì—…ê¶Œ</div>
											</div>
											<div class="t-item" style="height: ${investmentsHeight}px; background: linear-gradient(135deg, #1a5276 0%, #154360 100%);">
												<div class="t-label">íˆ¬ììì‚°</div>
												<div class="t-amount">${(investments / 1000000000000).toFixed(1)}ì¡°</div>
												<div class="t-caption">ì¥ê¸°ê¸ˆìœµìƒí’ˆ, íˆ¬ìë¶€ë™ì‚°</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="t-divider"></div>
							<div class="t-column">
								<div class="t-title">ë¶€ì±„ + ìë³¸</div>
		
								<!-- ìœ ë™ë¶€ì±„ ê·¸ë£¹ -->
								<div class="t-group-wrapper">
									<div class="t-group-label">
										<div>ğŸ“› ìœ ë™ë¶€ì±„</div>
										<div class="t-group-total">${(currentLiab / 1000000000000).toFixed(1)}ì¡°ì›</div>
									</div>
									<div class="t-group">
										<div class="t-group-content">
											<div class="t-item" style="height: ${payablesHeight}px; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
												<div class="t-label">ë§¤ì…ì±„ë¬´</div>
												<div class="t-amount">${(payables / 1000000000000).toFixed(1)}ì¡°</div>
												<div class="t-caption">ì›ì¬ë£Œ êµ¬ë§¤ ëŒ€ê¸ˆ ë¯¸ì§€ê¸‰ê¸ˆ</div>
											</div>
											<div class="t-item" style="height: ${shortDebtHeight}px; background: linear-gradient(135deg, #ec7063 0%, #e74c3c 100%);">
												<div class="t-label">ë‹¨ê¸°ì°¨ì…ê¸ˆ</div>
												<div class="t-amount">${(shortDebt / 1000000000000).toFixed(1)}ì¡°</div>
												<div class="t-caption">1ë…„ ë‚´ ìƒí™˜ ì°¨ì…ê¸ˆ</div>
											</div>
											<div class="t-item" style="height: ${otherCLHeight}px; background: linear-gradient(135deg, #f1948a 0%, #ec7063 100%);">
												<div class="t-label">ê¸°íƒ€ìœ ë™ë¶€ì±„</div>
												<div class="t-amount">${(otherCL / 1000000000000).toFixed(1)}ì¡°</div>
												<div class="t-caption">ë¯¸ì§€ê¸‰ë¹„ìš©, ì„ ìˆ˜ê¸ˆ ë“±</div>
											</div>
										</div>
									</div>
								</div>
		
								<!-- ë¹„ìœ ë™ë¶€ì±„ ê·¸ë£¹ -->
								<div class="t-group-wrapper">
									<div class="t-group-label">
										<div>ğŸ“• ë¹„ìœ ë™ë¶€ì±„</div>
										<div class="t-group-total">${(nonCurrentLiab / 1000000000000).toFixed(1)}ì¡°ì›</div>
									</div>
									<div class="t-group">
										<div class="t-group-content">
											<div class="t-item" style="height: ${longDebtHeight}px; background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);">
												<div class="t-label">ì¥ê¸°ì°¨ì…ê¸ˆ</div>
												<div class="t-amount">${(longDebt / 1000000000000).toFixed(1)}ì¡°</div>
												<div class="t-caption">1ë…„ ì´ìƒ ì¥ê¸° ì°¨ì…ê¸ˆ</div>
											</div>
											<div class="t-item" style="height: ${otherNCLHeight}px; background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
												<div class="t-label">ê¸°íƒ€ë¹„ìœ ë™ë¶€ì±„</div>
												<div class="t-amount">${(otherNCL / 1000000000000).toFixed(1)}ì¡°</div>
												<div class="t-caption">í‡´ì§ê¸‰ì—¬ì¶©ë‹¹ë¶€ì±„ ë“±</div>
											</div>
										</div>
									</div>
								</div>
		
								<!-- ìë³¸ ê·¸ë£¹ -->
								<div class="t-group-wrapper">
									<div class="t-group-label">
										<div>ğŸ’š ìë³¸</div>
										<div class="t-group-total">${(equity / 1000000000000).toFixed(1)}ì¡°ì›</div>
									</div>
									<div class="t-group">
										<div class="t-group-content">
											<div class="t-item" style="height: ${paidInHeight}px; background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);">
												<div class="t-label">ìë³¸ê¸ˆ+ìë³¸ì‰ì—¬ê¸ˆ</div>
												<div class="t-amount">${(paidInCapital / 1000000000000).toFixed(1)}ì¡°</div>
												<div class="t-caption">ì£¼ì£¼ ì¶œìê¸ˆ, ì£¼ì‹ë°œí–‰ì´ˆê³¼ê¸ˆ</div>
											</div>
											<div class="t-item" style="height: ${retainedHeight}px; background: linear-gradient(135deg, #58d68d 0%, #2ecc71 100%);">
												<div class="t-label">ì´ìµì‰ì—¬ê¸ˆ</div>
												<div class="t-amount">${(retainedEarnings / 1000000000000).toFixed(1)}ì¡°</div>
												<div class="t-caption">ëˆ„ì  ìˆœì´ìµ ë¯¸ë°°ë‹¹ì•¡</div>
											</div>
											<div class="t-item" style="height: ${otherEqHeight}px; background: linear-gradient(135deg, #82e0aa 0%, #58d68d 100%);">
												<div class="t-label">ê¸°íƒ€ìë³¸</div>
												<div class="t-amount">${(otherEquity / 1000000000000).toFixed(1)}ì¡°</div>
												<div class="t-caption">ê¸°íƒ€í¬ê´„ì†ìµëˆ„ê³„ì•¡ ë“±</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					`;
				}
		function updateCashflowChart() {
			const ctx = document.getElementById('cashflowChart').getContext('2d');
			if (charts.cashflow) charts.cashflow.destroy();

			// í˜„ì¬ ì„ íƒëœ íšŒì‚¬ì˜ í˜„ê¸ˆíë¦„ ë°ì´í„° í™•ì¸
			let cashflowData = null;
			let companyName = 'ì‚¼ì„±ì „ì';

			if (currentCompanyCode && allCashflowData[currentCompanyCode]) {
				cashflowData = allCashflowData[currentCompanyCode];
				companyName = currentCompanyName;
			} else if (samsungCashflowData && samsungCashflowData.annual) {
				cashflowData = samsungCashflowData;
			}

			// ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ í‘œì‹œ
			if (cashflowData && cashflowData.annual && cashflowData.annual.length > 0) {
				// 0ì´ ì•„ë‹Œ ë°ì´í„°ë§Œ í•„í„°ë§
				const data = cashflowData.annual.filter(d =>
					d.operating_cf !== 0 || d.investing_cf !== 0 || d.financing_cf !== 0
				);

				if (data.length === 0) {
					// ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€
					const container = document.getElementById('cashflowView');
					const chartContainer = container.querySelector('.chart-container');
					chartContainer.innerHTML = `<p style="text-align: center; padding: 50px; color: #7f8c8d;">í˜„ê¸ˆíë¦„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
					return;
				}

				const labels = data.map(d => d.period);
				const operatingCF = data.map(d => d.operating_cf / 1000000000000);
				const investingCF = data.map(d => d.investing_cf / 1000000000000);
				const financingCF = data.map(d => d.financing_cf / 1000000000000);

				charts.cashflow = new Chart(ctx, {
					type: 'bar',
					data: {
						labels: labels,
						datasets: [
							{
								label: 'ì˜ì—…í™œë™ í˜„ê¸ˆíë¦„',
								data: operatingCF,
								backgroundColor: 'rgba(54, 162, 235, 0.7)',
							},
							{
								label: 'íˆ¬ìí™œë™ í˜„ê¸ˆíë¦„',
								data: investingCF,
								backgroundColor: 'rgba(255, 99, 132, 0.7)',
							},
							{
								label: 'ì¬ë¬´í™œë™ í˜„ê¸ˆíë¦„',
								data: financingCF,
								backgroundColor: 'rgba(75, 192, 192, 0.7)',
							}
						]
					},
					options: {
						responsive: true,
						maintainAspectRatio: false,
						plugins: {
							title: { display: true, text: `${companyName} í˜„ê¸ˆíë¦„ (ì—°ê°„)`, font: { size: 18 } },
							legend: { display: true, position: 'top' },
							tooltip: {
								callbacks: {
									label: function(context) {
										let label = context.dataset.label || '';
										if (label) label += ': ';
										label += context.parsed.y.toFixed(1) + 'ì¡°ì›';
										return label;
									}
								}
							},
							datalabels: {
								display: false
							},
							annotation: {
								annotations: {
									line1: {
										type: 'line',
										yMin: 0,
										yMax: 0,
										borderColor: 'rgb(0, 0, 0)',
										borderWidth: 2,
									}
								}
							}
						},
						scales: {
							x: {
								stacked: true,
							},
							y: {
								stacked: true,
								title: { display: true, text: 'ê¸ˆì•¡ (ì¡°ì›)' },
								ticks: { callback: v => v.toFixed(0) + 'ì¡°' },
							}
						}
					}
				});
			} else {
				// ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
				const container = document.getElementById('cashflowView');
				const chartContainer = container.querySelector('.chart-container');
				chartContainer.innerHTML = `<p style="text-align: center; padding: 50px; color: #7f8c8d;">í˜„ê¸ˆíë¦„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
			}
		}

		// ì¢…ëª© ë¦¬ìŠ¤íŠ¸ë¡œ ì´ë™
		function goToIndex() {
			window.location.href = 'index.html';
		}

		window.addEventListener('load', loadData);
	</script>
</body>
</html>
